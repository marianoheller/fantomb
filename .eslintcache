[{"/home/wdw44/code/fantomb/src/index.tsx":"1","/home/wdw44/code/fantomb/src/reportWebVitals.ts":"2","/home/wdw44/code/fantomb/src/app/index.tsx":"3","/home/wdw44/code/fantomb/src/components/player/index.tsx":"4","/home/wdw44/code/fantomb/src/components/input/index.tsx":"5","/home/wdw44/code/fantomb/src/components/controls/index.tsx":"6","/home/wdw44/code/fantomb/src/components/timebar/index.tsx":"7","/home/wdw44/code/fantomb/src/components/timebar/region.tsx":"8","/home/wdw44/code/fantomb/src/components/recorder/index.tsx":"9","/home/wdw44/code/fantomb/src/shared/hooks/media.ts":"10","/home/wdw44/code/fantomb/src/shared/operators/mouse.ts":"11","/home/wdw44/code/fantomb/src/components/controls/hooks.ts":"12"},{"size":267,"mtime":1613407281670,"results":"13","hashOfConfig":"14"},{"size":425,"mtime":1613407281670,"results":"15","hashOfConfig":"14"},{"size":3306,"mtime":1613490775210,"results":"16","hashOfConfig":"14"},{"size":993,"mtime":1613425757290,"results":"17","hashOfConfig":"14"},{"size":981,"mtime":1613407281670,"results":"18","hashOfConfig":"14"},{"size":2799,"mtime":1613422107940,"results":"19","hashOfConfig":"14"},{"size":3995,"mtime":1613490835180,"results":"20","hashOfConfig":"14"},{"size":2604,"mtime":1613491706990,"results":"21","hashOfConfig":"14"},{"size":1758,"mtime":1613451711790,"results":"22","hashOfConfig":"14"},{"size":4565,"mtime":1613423593220,"results":"23","hashOfConfig":"14"},{"size":1495,"mtime":1613450804660,"results":"24","hashOfConfig":"14"},{"size":496,"mtime":1613421657520,"results":"25","hashOfConfig":"14"},{"filePath":"26","messages":"27","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},"agnh1m",{"filePath":"29","messages":"30","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},{"filePath":"31","messages":"32","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"33","usedDeprecatedRules":"28"},{"filePath":"34","messages":"35","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},{"filePath":"36","messages":"37","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},{"filePath":"38","messages":"39","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},{"filePath":"40","messages":"41","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"42","usedDeprecatedRules":"28"},{"filePath":"43","messages":"44","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"45","messages":"46","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},{"filePath":"47","messages":"48","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},{"filePath":"49","messages":"50","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},{"filePath":"51","messages":"52","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},"/home/wdw44/code/fantomb/src/index.tsx",[],["53","54"],"/home/wdw44/code/fantomb/src/reportWebVitals.ts",[],"/home/wdw44/code/fantomb/src/app/index.tsx",["55"],"import React, { useEffect, useRef } from \"react\";\n\nimport Player from \"../components/player\";\nimport Input from \"../components/input\";\nimport Timebar from \"../components/timebar\";\nimport Controls, { ControlAction } from \"../components/controls\";\n\nimport {\n  useObservable,\n  useObservableCallback,\n  useObservableState,\n  useSubscription,\n} from \"observable-hooks\";\nimport { filter, map, tap, throttleTime, withLatestFrom } from \"rxjs/operators\";\nimport { merge, OperatorFunction } from \"rxjs\";\nimport ReactPlayer from \"react-player\";\nimport Recorder from \"../components/recorder\";\n\ntype Region = { start: number; end: number };\ntype TRegion = Region | undefined;\n\nexport type Status = \"PlayingVideo\" | \"PlayingVoice\" | \"Recording\" | \"Idle\";\n\nfunction App() {\n  const playerRef = useRef<ReactPlayer>(null);\n\n  const [onUrlChange, url$] = useObservableCallback<string | undefined>(\n    (u$) => u$,\n    undefined\n  );\n\n  const [onRegion, region$] = useObservableCallback<TRegion>((r$) => r$);\n\n  const [onDuration, duration$] = useObservableCallback<number | undefined>(\n    (d$) => d$\n  );\n\n  const [onPlayerProgress, playerProgress$] = useObservableCallback<number>(\n    (n$) => n$\n  );\n\n  const [onManualProgress, manualProgress$] = useObservableCallback<number>(\n    (n$) => n$.pipe(tap((n) => playerRef.current?.seekTo(n)))\n  );\n\n  const progress$ = merge(playerProgress$, manualProgress$).pipe(\n    throttleTime(100)\n  );\n\n  const [status, onControlAction] = useObservableState<Status, ControlAction>(\n    (a$) =>\n      a$.pipe(\n        withLatestFrom(region$),\n        map(([{ type }, r]) => {\n          switch (type) {\n            case \"VideoStartedPlaying\":\n              if (r) playerRef.current?.seekTo(r.start)\n              return \"PlayingVideo\";\n            case \"VoiceStartedPlaying\":\n              return \"PlayingVoice\";\n            case \"VoiceStartedRecording\":\n              return \"Recording\";\n            case \"VideoStoppedPlaying\":\n            case \"VoiceStoppedPlaying\":\n            case \"VoiceStoppedRecording\":\n            default:\n              return \"Idle\";\n          }\n        })\n      ),\n    \"Idle\"\n  );\n\n  const regionEndAutomatically$ = useObservable<Region>(() =>\n    playerProgress$.pipe(\n      withLatestFrom(region$),\n      filter(([, r]) => r !== undefined) as OperatorFunction<\n        [number, TRegion],\n        [number, Region]\n      >,\n      filter(([v, r]) => v >= r.end),\n      map(([, r]) => r)\n    )\n  );\n\n  useSubscription(regionEndAutomatically$, (r) => {\n    onControlAction({ type: \"VideoStoppedPlaying\" });\n    playerRef.current?.seekTo(r.start);\n  });\n\n  return (\n    <div>\n      <p>https://www.youtube.com/watch?v=EqE_AH39144</p>\n      <Input onChange={onUrlChange} />\n      <Timebar\n        duration$={duration$}\n        progress={progress$}\n        onClick={onManualProgress}\n        onRegion={onRegion}\n        appRegion$={region$}\n      />\n      <Controls\n        status={status}\n        onAction={onControlAction}\n        duration$={duration$}\n      />\n      <Player\n        ref={playerRef}\n        url$={url$}\n        onDuration={onDuration}\n        onProgress={onPlayerProgress}\n        playing={status === \"PlayingVideo\"}\n      />\n      <Recorder disabled={false} status={status} onAction={onControlAction} />\n    </div>\n  );\n}\n\nexport default App;\n","/home/wdw44/code/fantomb/src/components/player/index.tsx",[],"/home/wdw44/code/fantomb/src/components/input/index.tsx",[],"/home/wdw44/code/fantomb/src/components/controls/index.tsx",[],"/home/wdw44/code/fantomb/src/components/timebar/index.tsx",["56","57"],"import React, { useRef } from \"react\";\nimport { merge, Observable, OperatorFunction, timer } from \"rxjs\";\nimport {\n  useObservable,\n  useObservableCallback,\n  useObservableState,\n  useSubscription,\n} from \"observable-hooks\";\nimport {\n  debounceTime,\n  filter,\n  map,\n  switchMap,\n  take,\n  takeUntil,\n  tap,\n  throttleTime,\n  withLatestFrom,\n} from \"rxjs/operators\";\nimport styled from \"styled-components\";\nimport * as mouse from \"../../shared/operators/mouse\";\n\nimport Region, { TRegion } from \"./region\";\n\ninterface TimebarProps {\n  duration$: Observable<number | undefined>;\n  progress: Observable<number>;\n  onClick: (x: number) => void;\n  onRegion: (r: TRegion) => void;\n  appRegion$: Observable<TRegion>;\n}\n\nconst Svg = styled.svg<{ interactable: boolean }>`\n  width: 100%;\n  height: 2rem;\n  background-color: rgb(240, 240, 240);\n  cursor: ${({ interactable }) => (interactable ? \"pointer\" : \"auto\")};\n  pointer-events: ${({ interactable }) => (interactable ? \"all\" : \"none\")};\n`;\n\nconst Marker = styled.rect`\n  width: 1px;\n  height: 100%;\n  fill: rgb(10, 10, 10);\n`;\n\nconst Timebar: React.FC<TimebarProps> = ({\n  duration$,\n  progress,\n  onClick,\n  onRegion,\n  appRegion$,\n}) => {\n  const svgRef = useRef(null);\n  const duration = useObservableState(duration$);\n  const [markerPosition] = useObservableState<string>(\n    () =>\n      progress.pipe(\n        map((v) => {\n          if (!v) return \"0px\";\n          return `${v * 100}%`;\n        })\n      ),\n    \"0px\"\n  );\n\n  const [onWheel, wheel$] = useObservableCallback<\n    React.MouseEvent<SVGSVGElement, WheelEvent>\n  >((e$) =>\n    e$.pipe(\n      map((e) => {\n        e.stopPropagation();\n        return e;\n      })\n    )\n  );\n\n  const [onMouseDown, mouseDown$] = useObservableCallback<\n    React.MouseEvent<SVGSVGElement, MouseEvent>\n  >((e$) => e$.pipe(map(mouse.preventDefault)));\n\n  const [onMouseUp, mouseUp$] = useObservableCallback<\n    React.MouseEvent<SVGSVGElement, MouseEvent>\n  >((e$) => e$.pipe(map(mouse.preventDefault)));\n\n  const mousePosRelative$ = mouse.globalMouseMove$.pipe(\n    map(mouse.globalMouseEventToXDistance(svgRef)),\n    filter((v) => v !== undefined) as OperatorFunction<\n      number | undefined,\n      number\n    >\n  );\n\n  const [_onClick, click$] = useObservableCallback<\n    React.MouseEvent<SVGSVGElement, MouseEvent>\n  >((e$) => e$);\n\n  const leftClick$ = click$.pipe(\n    filter((e) => e.button === 0),\n    map(mouse.globalMouseEventToXDistance(svgRef))\n  );\n\n  const rightClick$ = mouseDown$.pipe(\n    filter((e) => e.button === 2),\n    throttleTime(500)\n  );\n\n  const holdClick$ = mouseDown$.pipe(\n    switchMap((e) =>\n      timer(100).pipe(\n        takeUntil(mouseUp$),\n        map(() => mouse.globalMouseEventToXDistance(svgRef)(e))\n      )\n    )\n  );\n\n  const regionClear$ = rightClick$.pipe(map(() => undefined));\n\n  const _region$: Observable<TRegion> = merge(\n    holdClick$.pipe(\n      switchMap((x1) =>\n        mousePosRelative$.pipe(\n          map((x2) => {\n            if (x1 > x2) return { start: x2, end: x1 };\n            else return { start: x1, end: x2 };\n          }),\n          takeUntil(mouseUp$)\n        )\n      )\n    ),\n    regionClear$\n  );\n\n  const regionEnd$ = holdClick$.pipe(\n    switchMap(() => mouseUp$.pipe(take(1))),\n    withLatestFrom(_region$),\n    map(([_, r]) => r)\n  );\n\n  useSubscription(leftClick$, onClick);\n  useSubscription(regionEnd$, onRegion);\n  useSubscription(regionClear$, onRegion);\n  useSubscription(wheel$, () => console.warn(\"WHEEL\"));\n\n  const region$ = useObservable(() => merge(appRegion$, _region$))\n\n  return (\n    <>\n      <Svg\n        ref={svgRef}\n        onContextMenu={(e) => e.preventDefault()}\n        onClick={_onClick}\n        onMouseUp={onMouseUp}\n        onMouseDown={onMouseDown}\n        onWheel={onWheel}\n        interactable={duration !== undefined}\n      >\n        <Marker x={markerPosition} />\n        <Region region$={region$} containerRef={svgRef} onRegion={onRegion} />\n      </Svg>\n    </>\n  );\n};\n\nexport default Timebar;\n","/home/wdw44/code/fantomb/src/components/timebar/region.tsx",["58","59","60","61"],"/home/wdw44/code/fantomb/src/components/recorder/index.tsx",[],"/home/wdw44/code/fantomb/src/shared/hooks/media.ts",[],"/home/wdw44/code/fantomb/src/shared/operators/mouse.ts",[],"/home/wdw44/code/fantomb/src/components/controls/hooks.ts",[],{"ruleId":"62","replacedBy":"63"},{"ruleId":"64","replacedBy":"65"},{"ruleId":"66","severity":1,"message":"67","line":1,"column":17,"nodeType":"68","messageId":"69","endLine":1,"endColumn":26},{"ruleId":"66","severity":1,"message":"70","line":10,"column":3,"nodeType":"68","messageId":"69","endLine":10,"endColumn":15},{"ruleId":"66","severity":1,"message":"71","line":16,"column":3,"nodeType":"68","messageId":"69","endLine":16,"endColumn":6},{"ruleId":"66","severity":1,"message":"72","line":1,"column":28,"nodeType":"68","messageId":"69","endLine":1,"endColumn":34},{"ruleId":"66","severity":1,"message":"73","line":2,"column":10,"nodeType":"68","messageId":"69","endLine":2,"endColumn":23},{"ruleId":"66","severity":1,"message":"74","line":2,"column":44,"nodeType":"68","messageId":"69","endLine":2,"endColumn":46},{"ruleId":"66","severity":1,"message":"71","line":17,"column":3,"nodeType":"68","messageId":"69","endLine":17,"endColumn":6},"no-native-reassign",["75"],"no-negated-in-lhs",["76"],"@typescript-eslint/no-unused-vars","'useEffect' is defined but never used.","Identifier","unusedVar","'debounceTime' is defined but never used.","'tap' is defined but never used.","'useRef' is defined but never used.","'combineLatest' is defined but never used.","'of' is defined but never used.","no-global-assign","no-unsafe-negation"]